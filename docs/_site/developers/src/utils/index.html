<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Utils Module | Prisma AIRS MCP</title>
  <meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection">
  
  <!-- SEO Tags -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Utils Module | Prisma AIRS MCP</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Utils Module" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Utilities (src/utils/)" />
<meta property="og:description" content="Utilities (src/utils/)" />
<link rel="canonical" href="http://localhost:4000/developers/src/utils/" />
<meta property="og:url" content="http://localhost:4000/developers/src/utils/" />
<meta property="og:site_name" content="Prisma AIRS MCP" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Utils Module" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Utilities (src/utils/)","headline":"Utils Module","url":"http://localhost:4000/developers/src/utils/"}</script>
<!-- End Jekyll SEO tag -->

  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Rouge syntax highlighting is handled by Jekyll -->
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a href="/" class="navbar-logo">
          <i class="fas fa-shield-alt"></i>
          Prisma AIRS MCP
        </a>
      </div>
      <div class="navbar-menu">
        <a href="/deployment" class="navbar-item ">Deployment</a>
        <a href="/developers" class="navbar-item active">Developers</a>
        <a href="/prisma-airs/overview" class="navbar-item ">Prisma AIRS</a>
        <a href="https://github.com/cdot65/prisma-airs-mcp" class="navbar-item">
          <i class="fab fa-github"></i>
        </a>
      </div>
    </div>
  </nav>

  <div class="documentation-layout">
    <aside class="sidebar">
      
<nav class="sidebar-nav">
  <h4>Getting Started</h4>
  <ul>
    <li><a href="/developers/overview/" >Overview</a></li>
  </ul>
  
  <h4>Source Code Documentation</h4>
  <ul>
    <li><a href="/developers/src/" >Root (src/)</a></li>
    <li><a href="/developers/src/types/" >Types Module</a></li>
    <li><a href="/developers/src/airs/" >AIRS Module</a></li>
    <li><a href="/developers/src/config/" >Configuration</a></li>
    <li><a href="/developers/src/prompts/" >Prompts</a></li>
    <li><a href="/developers/src/resources/" >Resources</a></li>
    <li><a href="/developers/src/tools/" >Tools</a></li>
    <li><a href="/developers/src/transport/" >Transport</a></li>
    <li><a href="/developers/src/utils/" class="active">Utilities</a></li>
  </ul>
  
  <h4>API</h4>
  <ul>
    <li><a href="/developers/api/" >API Reference</a></li>
  </ul>
  
  <h4>Release Notes</h4>
  <ul>
    <li><a href="/developers/release-notes/" >Version History</a></li>
  </ul>
</nav>



<style>
.sidebar-nav {
  padding: var(--spacing-md);
}

.sidebar-nav h4 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--gray);
  margin-bottom: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

.sidebar-nav h4:first-child {
  margin-top: 0;
}

.sidebar-nav ul {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--spacing-md) 0;
}

.sidebar-nav li {
  margin-bottom: var(--spacing-xs);
}

.sidebar-nav a {
  display: block;
  padding: var(--spacing-xs) var(--spacing-sm);
  color: var(--dark);
  border-radius: var(--border-radius);
  font-size: 0.9375rem;
  transition: all 0.2s ease;
}

.sidebar-nav a:hover {
  background-color: var(--gray-light);
  text-decoration: none;
}

.sidebar-nav a.active {
  background-color: var(--primary);
  color: var(--white);
  font-weight: 500;
}

.sidebar-nav a.active:hover {
  background-color: var(--primary-dark);
}
</style>
    </aside>
    
    <main class="documentation-content">
      <div class="content-header">
        <h1>Utils Module</h1>
        
      </div>
      
      <article class="content">
        <h1 id="utilities-srcutils">Utilities (src/utils/)</h1>

<p>The utils module provides utility functions used throughout the Prisma AIRS MCP server. Currently, it contains the logging system implementation using Winston.</p>

<h2 id="module-structure">Module Structure</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/utils/
└── logger.ts    # Winston logger configuration and initialization
</code></pre></div></div>

<h2 id="architecture-overview">Architecture Overview</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────┐
│         Application Module              │
│    (any module in the codebase)         │
└─────────────────┬───────────────────────┘
                  │
                  │ getLogger()
                  ▼
┌─────────────────────────────────────────┐
│          Logger Singleton               │
│  • Lazy initialization                  │
│  • Environment-aware formatting         │
│  • Configured log levels                │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         Winston Logger                  │
│  • Timestamp formatting                 │
│  • Error stack traces                   │
│  • Default metadata                     │
└─────────────────┬───────────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
┌───────▼────────┐ ┌────────▼──────┐
│  Development   │ │  Production   │
│  • Colorized   │ │  • JSON       │
│  • Simple      │ │  • Structured │
└────────────────┘ └───────────────┘
</code></pre></div></div>

<h2 id="logger-implementation">Logger Implementation</h2>

<h3 id="overview">Overview</h3>

<p>The logger module provides a centralized logging system using Winston, with environment-specific formatting and configuration derived from the application’s config module.</p>

<h3 id="logger-configuration">Logger Configuration</h3>

<p>The logger is configured based on environment settings:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Configuration sources</span>
<span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">getConfig</span><span class="p">();</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">environment</span><span class="p">,</span> <span class="nx">logLevel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">;</span>

<span class="c1">// Logger setup</span>
<span class="nx">logger</span> <span class="o">=</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">createLogger</span><span class="p">({</span>
    <span class="na">level</span><span class="p">:</span> <span class="nx">logLevel</span><span class="p">,</span> <span class="c1">// From LOG_LEVEL env var</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">combine</span><span class="p">(...</span><span class="nx">formats</span><span class="p">),</span>
    <span class="na">defaultMeta</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">service</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverName</span><span class="p">,</span>
        <span class="na">version</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverVersion</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">transports</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
            <span class="na">silent</span><span class="p">:</span> <span class="nx">environment</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">}),</span>
    <span class="p">],</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="environment-specific-formatting">Environment-Specific Formatting</h3>

<h4 id="development-environment">Development Environment</h4>

<p>In development, logs are formatted for human readability:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">environment</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">formats</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
        <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">colorize</span><span class="p">(),</span> <span class="c1">// Colorized output</span>
        <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">simple</span><span class="p">(),</span> <span class="c1">// Simple format</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Example output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2024-01-01T12:00:00.000Z info: Server started on port 3000
2024-01-01T12:00:01.000Z debug: Processing request {"requestId": "123"}
2024-01-01T12:00:02.000Z error: Failed to scan content {"error": "Invalid input"}
</code></pre></div></div>

<h4 id="production-environment">Production Environment</h4>

<p>In production, logs are formatted as JSON for parsing by log aggregation systems:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="p">{</span>
    <span class="nx">formats</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Example output:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"Server started on port 3000"</span><span class="p">,</span><span class="nl">"service"</span><span class="p">:</span><span class="s2">"prisma-airs-mcp"</span><span class="p">,</span><span class="nl">"version"</span><span class="p">:</span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2024-01-01T12:00:00.000Z"</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"level"</span><span class="p">:</span><span class="s2">"error"</span><span class="p">,</span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"Failed to scan content"</span><span class="p">,</span><span class="nl">"error"</span><span class="p">:</span><span class="s2">"Invalid input"</span><span class="p">,</span><span class="nl">"service"</span><span class="p">:</span><span class="s2">"prisma-airs-mcp"</span><span class="p">,</span><span class="nl">"version"</span><span class="p">:</span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2024-01-01T12:00:02.000Z"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="test-environment">Test Environment</h3>

<p>In test environment, console output is silenced:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">transports</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
        <span class="na">silent</span><span class="p">:</span> <span class="nx">environment</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}),</span>
<span class="p">];</span>
</code></pre></div></div>

<h2 id="api-functions">API Functions</h2>

<h3 id="createlogger">createLogger()</h3>

<p>Creates and configures a Winston logger instance:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">createLogger</span><span class="p">():</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">Logger</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">logger</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">getConfig</span><span class="p">();</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">environment</span><span class="p">,</span> <span class="nx">logLevel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">formats</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">(),</span>
        <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">errors</span><span class="p">({</span> <span class="na">stack</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">environment</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">formats</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">colorize</span><span class="p">(),</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">simple</span><span class="p">());</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">formats</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nx">logger</span> <span class="o">=</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">createLogger</span><span class="p">({</span>
        <span class="na">level</span><span class="p">:</span> <span class="nx">logLevel</span><span class="p">,</span>
        <span class="na">format</span><span class="p">:</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">combine</span><span class="p">(...</span><span class="nx">formats</span><span class="p">),</span>
        <span class="na">defaultMeta</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">service</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverName</span><span class="p">,</span>
            <span class="na">version</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverVersion</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="na">transports</span><span class="p">:</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
                <span class="na">silent</span><span class="p">:</span> <span class="nx">environment</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">}),</span>
        <span class="p">],</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">logger</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Features:</strong></p>

<ul>
  <li>Singleton pattern - returns existing logger if already created</li>
  <li>Configures format based on environment</li>
  <li>Sets log level from configuration</li>
  <li>Adds default metadata (service name and version)</li>
  <li>Includes timestamp and error stack traces</li>
</ul>

<h3 id="getlogger">getLogger()</h3>

<p>Gets the logger instance, creating it if necessary:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">getLogger</span><span class="p">():</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">Logger</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">logger</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">createLogger</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">logger</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Features:</strong></p>

<ul>
  <li>Lazy initialization</li>
  <li>Ensures logger is always available</li>
  <li>Most commonly used function throughout the codebase</li>
</ul>

<p><strong>Usage Example:</strong></p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">getLogger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../utils/logger</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">getLogger</span><span class="p">();</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Processing request</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">requestId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span> <span class="p">});</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Operation failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
</code></pre></div></div>

<h2 id="log-levels">Log Levels</h2>

<p>The logger supports standard Winston log levels, configured via the <code class="language-plaintext highlighter-rouge">LOG_LEVEL</code> environment variable:</p>

<table>
  <thead>
    <tr>
      <th>Level</th>
      <th>Usage</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">error</code></td>
      <td>Error conditions that need attention</td>
      <td><code class="language-plaintext highlighter-rouge">logger.error('Database connection failed')</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">warn</code></td>
      <td>Warning conditions</td>
      <td><code class="language-plaintext highlighter-rouge">logger.warn('Rate limit approaching')</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">info</code></td>
      <td>Informational messages</td>
      <td><code class="language-plaintext highlighter-rouge">logger.info('Server started')</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">debug</code></td>
      <td>Debug information</td>
      <td><code class="language-plaintext highlighter-rouge">logger.debug('Request details', { body })</code></td>
    </tr>
  </tbody>
</table>

<h2 id="default-metadata">Default Metadata</h2>

<p>All log entries automatically include:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">defaultMeta</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">service</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverName</span><span class="p">,</span>    <span class="c1">// e.g., "prisma-airs-mcp"</span>
    <span class="nx">version</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverVersion</span><span class="p">,</span>  <span class="c1">// e.g., "1.0.0"</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="basic-logging">Basic Logging</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">getLogger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../utils/logger</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">ExampleService</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">getLogger</span><span class="p">();</span>

    <span class="k">async</span> <span class="nx">processRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Processing request</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">dataSize</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">performOperation</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Operation completed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">result</span> <span class="p">});</span>
            <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Operation failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">error</span><span class="p">:</span> <span class="nx">error</span> <span class="k">instanceof</span> <span class="nb">Error</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Unknown error</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">stack</span><span class="p">:</span> <span class="nx">error</span> <span class="k">instanceof</span> <span class="nb">Error</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">stack</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
            <span class="p">});</span>
            <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="structured-logging">Structured Logging</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Log with structured data</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Scan completed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">scanId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">scan_12345</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">duration</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="na">threatCount</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="na">action</span><span class="p">:</span> <span class="dl">'</span><span class="s1">block</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Log with nested objects</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">API request</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/scan</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="p">{</span> <span class="na">truncated</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="error-logging">Error Logging</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Log errors with stack traces</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">riskyOperation</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Operation failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">error</span><span class="p">:</span> <span class="nx">error</span> <span class="k">instanceof</span> <span class="nb">Error</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Unknown error</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">code</span><span class="p">:</span> <span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">APIError</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">code</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="na">context</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">operation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">riskyOperation</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">input</span><span class="p">:</span> <span class="nx">sanitizedInput</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="integration-examples">Integration Examples</h2>

<h3 id="airs-client-integration">AIRS Client Integration</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// From src/airs/client.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PrismaAIRSClient</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">logger</span><span class="p">:</span> <span class="nx">Logger</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">config</span><span class="p">:</span> <span class="nx">AIRSClientConfig</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span> <span class="o">=</span> <span class="nx">getLogger</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prisma AIRS client initialized</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">baseUrl</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="p">,</span>
            <span class="na">timeout</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
            <span class="na">maxRetries</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">maxRetries</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">makeRequest</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Making AIRS API request</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">method</span><span class="p">,</span>
            <span class="nx">url</span><span class="p">,</span>
            <span class="nx">retryCount</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="tool-handler-integration">Tool Handler Integration</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// From src/tools/index.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ToolHandler</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">logger</span><span class="p">:</span> <span class="nx">Logger</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span> <span class="o">=</span> <span class="nx">getLogger</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">callTool</span><span class="p">(</span><span class="nx">params</span><span class="p">:</span> <span class="nx">ToolsCallParams</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Calling tool</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">hasArguments</span><span class="p">:</span> <span class="o">!!</span><span class="nx">params</span><span class="p">.</span><span class="nx">arguments</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="best-practices">Best Practices</h2>

<h3 id="1-use-appropriate-log-levels">1. Use Appropriate Log Levels</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Error - Something failed that shouldn't have</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database connection lost</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>

<span class="c1">// Warn - Something concerning but handled</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rate limit near threshold</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">current</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">100</span> <span class="p">});</span>

<span class="c1">// Info - Important business events</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">User authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="p">});</span>

<span class="c1">// Debug - Detailed troubleshooting info</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache hit</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">key</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="p">});</span>
</code></pre></div></div>

<h3 id="2-include-contextual-data">2. Include Contextual Data</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good - includes context</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Scan failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">scanId</span><span class="p">,</span>
    <span class="nx">profileName</span><span class="p">,</span>
    <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
    <span class="na">duration</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Bad - no context</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Scan failed</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="3-avoid-logging-sensitive-data">3. Avoid Logging Sensitive Data</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good - sanitized</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">User login</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">(</span><span class="sr">.</span><span class="se">{2})</span><span class="sr">.*</span><span class="se">(</span><span class="sr">@.*</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$1***$2</span><span class="dl">'</span><span class="p">),</span>
<span class="p">});</span>

<span class="c1">// Bad - exposes sensitive data</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">User login</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="c1">// Never log passwords!</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="4-use-consistent-field-names">4. Use Consistent Field Names</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Consistent field naming across the application</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Operation completed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">requestId</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="c1">// Always use 'requestId'</span>
    <span class="na">duration</span><span class="p">:</span> <span class="nx">elapsed</span><span class="p">,</span> <span class="c1">// Always use 'duration' for time</span>
    <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="c1">// Always use 'userId'</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="performance-considerations">Performance Considerations</h2>

<ol>
  <li><strong>Log Level Filtering</strong> - Debug logs are only evaluated when LOG_LEVEL includes them</li>
  <li><strong>Lazy Evaluation</strong> - Use functions for expensive computations:
    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Large data</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
     <span class="na">data</span><span class="p">:</span> <span class="nx">expensiveSerializationFunction</span><span class="p">(),</span>
 <span class="p">}));</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Test Environment</strong> - Logs are completely silent in test environment</li>
</ol>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues</h3>

<ol>
  <li><strong>No Log Output</strong>
    <ul>
      <li>Check <code class="language-plaintext highlighter-rouge">LOG_LEVEL</code> environment variable</li>
      <li>Verify <code class="language-plaintext highlighter-rouge">NODE_ENV</code> is set correctly</li>
      <li>Ensure logger is initialized</li>
    </ul>
  </li>
  <li><strong>Wrong Format</strong>
    <ul>
      <li>Development uses colorized simple format</li>
      <li>Production uses JSON format</li>
      <li>Check <code class="language-plaintext highlighter-rouge">NODE_ENV</code> setting</li>
    </ul>
  </li>
  <li><strong>Missing Metadata</strong>
    <ul>
      <li>Default metadata comes from config</li>
      <li>Ensure config is loaded before logger</li>
    </ul>
  </li>
</ol>

<h3 id="debug-logger-issues">Debug Logger Issues</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Check logger configuration</span>
<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">getLogger</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Log level:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">level</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Transports:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Environment:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="type-system">Type System</h2>

<p>The logger module uses standard Winston types:</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Module</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">winston.Logger</code></td>
      <td><code class="language-plaintext highlighter-rouge">winston</code></td>
      <td>Logger instance type</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">winston.LoggerOptions</code></td>
      <td><code class="language-plaintext highlighter-rouge">winston</code></td>
      <td>Logger configuration options</td>
    </tr>
  </tbody>
</table>

<h2 id="dependencies">Dependencies</h2>

<h3 id="external-dependencies">External Dependencies</h3>

<table>
  <thead>
    <tr>
      <th>Module</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">winston</code></td>
      <td>Logging framework</td>
    </tr>
  </tbody>
</table>

<h3 id="internal-dependencies">Internal Dependencies</h3>

<table>
  <thead>
    <tr>
      <th>Module</th>
      <th>Import</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">../config</code></td>
      <td><code class="language-plaintext highlighter-rouge">getConfig()</code></td>
      <td>Configuration access</td>
    </tr>
  </tbody>
</table>

<h2 id="future-enhancements">Future Enhancements</h2>

<p>Potential additions to the utils module:</p>

<ol>
  <li><strong>Additional Utilities</strong>:
    <ul>
      <li>Error helpers and custom error classes</li>
      <li>Validation utilities</li>
      <li>Data sanitization functions</li>
      <li>Retry helpers</li>
      <li>Async utilities</li>
    </ul>
  </li>
  <li><strong>Logger Enhancements</strong>:
    <ul>
      <li>File rotation transport</li>
      <li>External service integration (CloudWatch, Datadog)</li>
      <li>Request ID tracking</li>
      <li>Performance metrics logging</li>
      <li>Separate audit log transport</li>
    </ul>
  </li>
</ol>

<h2 id="related-documentation">Related Documentation</h2>

<ul>
  <li><a href="/developers/src/config/">Configuration Module</a> - How logger gets its configuration</li>
  <li><a href="/developers/src/">Application Entry Point</a> - Logger initialization on startup</li>
  <li><a href="/developers/src/airs/">AIRS Module</a> - Example logger usage in production</li>
  <li><a href="/developers/src/tools/">Tools Module</a> - Logger usage patterns</li>
</ul>

<h2 id="summary">Summary</h2>

<p>The utils module currently provides a simple but powerful logging system that adapts to different environments. The singleton pattern ensures consistent logging throughout the application, while environment-specific formatting makes logs suitable for both development debugging and production monitoring.</p>

      </article>
      
      <div class="content-footer">
        <div class="edit-page">
          <a href="https://github.com/cdot65/prisma-airs-mcp/edit/main/docs/_developers/src/utils.md">
            <i class="fas fa-edit"></i> Edit this page on GitHub
          </a>
        </div>
        
        
      </div>
    </main>
    
    <aside class="toc">
      <h4>On this page</h4>
      <nav id="table-of-contents"></nav>
    </aside>
  </div>

  <!-- Syntax highlighting is handled by Jekyll Rouge -->
  <script src="/assets/js/main.js"></script>
</body>
</html>