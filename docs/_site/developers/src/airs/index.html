<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIRS Client Module | Prisma AIRS MCP</title>
  <meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection">
  
  <!-- SEO Tags -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AIRS Client Module | Prisma AIRS MCP</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="AIRS Client Module" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AIRS Integration Layer (src/airs/)" />
<meta property="og:description" content="AIRS Integration Layer (src/airs/)" />
<link rel="canonical" href="http://localhost:4000/developers/src/airs/" />
<meta property="og:url" content="http://localhost:4000/developers/src/airs/" />
<meta property="og:site_name" content="Prisma AIRS MCP" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AIRS Client Module" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"AIRS Integration Layer (src/airs/)","headline":"AIRS Client Module","url":"http://localhost:4000/developers/src/airs/"}</script>
<!-- End Jekyll SEO tag -->

  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Rouge syntax highlighting is handled by Jekyll -->
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a href="/" class="navbar-logo">
          <i class="fas fa-shield-alt"></i>
          Prisma AIRS MCP
        </a>
      </div>
      <div class="navbar-menu">
        <a href="/deployment" class="navbar-item ">Deployment</a>
        <a href="/developers" class="navbar-item active">Developers</a>
        <a href="/prisma-airs/overview" class="navbar-item ">Prisma AIRS</a>
        <a href="https://github.com/cdot65/prisma-airs-mcp" class="navbar-item">
          <i class="fab fa-github"></i>
        </a>
      </div>
    </div>
  </nav>

  <div class="documentation-layout">
    <aside class="sidebar">
      
<nav class="sidebar-nav">
  <h4>Getting Started</h4>
  <ul>
    <li><a href="/developers/overview/" >Overview</a></li>
  </ul>
  
  <h4>Source Code Documentation</h4>
  <ul>
    <li><a href="/developers/src/" >Root (src/)</a></li>
    <li><a href="/developers/src/types/" >Types Module</a></li>
    <li><a href="/developers/src/airs/" class="active">AIRS Module</a></li>
    <li><a href="/developers/src/config/" >Configuration</a></li>
    <li><a href="/developers/src/prompts/" >Prompts</a></li>
    <li><a href="/developers/src/resources/" >Resources</a></li>
    <li><a href="/developers/src/tools/" >Tools</a></li>
    <li><a href="/developers/src/transport/" >Transport</a></li>
    <li><a href="/developers/src/utils/" >Utilities</a></li>
  </ul>
  
  <h4>API</h4>
  <ul>
    <li><a href="/developers/api/" >API Reference</a></li>
  </ul>
  
  <h4>Release Notes</h4>
  <ul>
    <li><a href="/developers/release-notes/" >Version History</a></li>
  </ul>
</nav>



<style>
.sidebar-nav {
  padding: var(--spacing-md);
}

.sidebar-nav h4 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--gray);
  margin-bottom: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

.sidebar-nav h4:first-child {
  margin-top: 0;
}

.sidebar-nav ul {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--spacing-md) 0;
}

.sidebar-nav li {
  margin-bottom: var(--spacing-xs);
}

.sidebar-nav a {
  display: block;
  padding: var(--spacing-xs) var(--spacing-sm);
  color: var(--dark);
  border-radius: var(--border-radius);
  font-size: 0.9375rem;
  transition: all 0.2s ease;
}

.sidebar-nav a:hover {
  background-color: var(--gray-light);
  text-decoration: none;
}

.sidebar-nav a.active {
  background-color: var(--primary);
  color: var(--white);
  font-weight: 500;
}

.sidebar-nav a.active:hover {
  background-color: var(--primary-dark);
}
</style>
    </aside>
    
    <main class="documentation-content">
      <div class="content-header">
        <h1>AIRS Client Module</h1>
        
      </div>
      
      <article class="content">
        <h1 id="airs-integration-layer-srcairs">AIRS Integration Layer (src/airs/)</h1>

<p>The AIRS module provides a production-ready client implementation for integrating with Prisma AI Runtime Security (AIRS) API. It features a layered architecture with caching, rate limiting, retry logic, and comprehensive error handling.</p>

<h2 id="module-structure">Module Structure</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/airs/
├── client.ts        # Core REST API client with retry logic
├── cache.ts         # LRU cache implementation for responses
├── rate-limiter.ts  # Token bucket rate limiting
├── index.ts         # Enhanced client orchestrating all features
└── factory.ts       # Singleton factory for client instances
</code></pre></div></div>

<h2 id="architecture-overview">Architecture Overview</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────────┐
│            Application Code                 │
└─────────────────┬───────────────────────────┘
                  │ Uses singleton via factory
┌─────────────────▼───────────────────────────┐
│          EnhancedPrismaAirsClient           │
│              (index.ts)                     │
│  • Orchestrates all features                │
│  • Provides unified API                     │
└─────────┬──────────┬──────────┬─────────────┘
          │          │          │
┌─────────▼───┐ ┌────▼────┐ ┌──▼──────────────┐
│   Cache     │ │  Rate   │ │  Base Client    │
│ (cache.ts)  │ │ Limiter │ │ (client.ts)     │
│             │ │         │ │                 │
│ • LRU evict │ │ • Token │ │ • HTTP calls    │
│ • TTL expiry│ │  bucket │ │ • Retry logic   │
│ • SHA keys  │ │ • Queue │ │ • Error handle  │
└─────────────┘ └─────────┘ └────────┬────────┘
                                     │
                            ┌────────▼────────┐
                            │ Prisma AIRS API │
                            └─────────────────┘
</code></pre></div></div>

<h2 id="core-components">Core Components</h2>

<h3 id="1-base-client-clientts">1. Base Client (client.ts)</h3>

<p>The foundation layer handling all HTTP communication with the AIRS API.</p>

<h4 id="key-features">Key Features</h4>

<ul>
  <li><strong>Automatic Retry</strong>: Exponential backoff for transient failures</li>
  <li><strong>Error Handling</strong>: Typed errors with status codes</li>
  <li><strong>Request Validation</strong>: Parameter checking before API calls</li>
  <li><strong>Logging</strong>: Structured logging of all operations</li>
</ul>

<h4 id="configuration">Configuration</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Imported from '../types'</span>
<span class="kr">interface</span> <span class="nx">AirsClientConfig</span> <span class="p">{</span>
    <span class="nl">apiUrl</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>      <span class="c1">// Base URL for AIRS API</span>
    <span class="nl">apiKey</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>      <span class="c1">// Authentication token (x-pan-token)</span>
    <span class="nl">timeout</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>    <span class="c1">// Request timeout in ms (default: 30000)</span>
    <span class="nl">maxRetries</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span> <span class="c1">// Retry attempts (default: 3)</span>
    <span class="nl">retryDelay</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span> <span class="c1">// Initial retry delay in ms (default: 1000)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="api-methods">API Methods</h4>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Endpoint</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">scanSync()</code></td>
      <td><code class="language-plaintext highlighter-rouge">POST /v1/scan/sync/request</code></td>
      <td>Real-time content scanning</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">scanAsync()</code></td>
      <td><code class="language-plaintext highlighter-rouge">POST /v1/scan/async/request</code></td>
      <td>Batch scanning</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getScanResults()</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET /v1/scan/results</code></td>
      <td>Retrieve scan results</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getThreatReports()</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET /v1/scan/reports</code></td>
      <td>Get detailed reports</td>
    </tr>
  </tbody>
</table>

<h4 id="error-handling">Error Handling</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">PrismaAirsApiError</span> <span class="kd">extends</span> <span class="nb">Error</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="nx">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="k">public</span> <span class="nx">statusCode</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
        <span class="k">public</span> <span class="nx">response</span><span class="p">?:</span> <span class="nx">AirsErrorResponse</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">PrismaAirsApiError</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Common Error Codes</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">400</code> - Bad request (invalid parameters)</li>
  <li><code class="language-plaintext highlighter-rouge">401</code> - Unauthorized (invalid API key)</li>
  <li><code class="language-plaintext highlighter-rouge">429</code> - Rate limited</li>
  <li><code class="language-plaintext highlighter-rouge">500</code> - Server error</li>
</ul>

<h3 id="2-cache-layer-cachets">2. Cache Layer (cache.ts)</h3>

<p>In-memory LRU cache reducing API calls and improving response times.</p>

<h4 id="features">Features</h4>

<ul>
  <li><strong>LRU Eviction</strong>: Removes least recently used items when full</li>
  <li><strong>TTL Support</strong>: Automatic expiration of stale entries</li>
  <li><strong>SHA-256 Keys</strong>: Consistent hashing for cache keys</li>
  <li><strong>Hit Rate Tracking</strong>: Performance metrics</li>
</ul>

<h4 id="configuration-1">Configuration</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">AirsCacheConfig</span> <span class="p">{</span>
    <span class="nl">enabled</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>    <span class="c1">// Enable/disable caching (default: true)</span>
    <span class="nl">maxSize</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>     <span class="c1">// Maximum cache entries (default: 1000)</span>
    <span class="nl">ttlSeconds</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>  <span class="c1">// Time-to-live in seconds (default: 300)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="cache-key-generation">Cache Key Generation</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Key format: prefix:sha256(normalized_json)</span>
<span class="nx">generateKey</span><span class="p">(</span><span class="nx">prefix</span>
<span class="p">:</span>
<span class="kr">string</span><span class="p">,</span> <span class="nx">data</span>
<span class="p">:</span>
<span class="nx">unknown</span>
<span class="p">):</span>
<span class="kr">string</span>
<span class="p">{</span>
    <span class="kd">const</span> <span class="nx">normalized</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sortKeys</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">normalized</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">hash</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="statistics">Statistics</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CacheStats</span> <span class="p">{</span>
    <span class="nl">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>        <span class="c1">// Current number of entries</span>
    <span class="nl">maxSize</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>     <span class="c1">// Maximum allowed entries</span>
    <span class="nl">hits</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>        <span class="c1">// Total cache hits</span>
    <span class="nl">misses</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>      <span class="c1">// Total cache misses</span>
    <span class="nl">hitRate</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>     <span class="c1">// Hit rate percentage</span>
    <span class="nl">evictions</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>   <span class="c1">// Total evictions</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-rate-limiter-rate-limiterts">3. Rate Limiter (rate-limiter.ts)</h3>

<p>Token bucket implementation preventing API quota exhaustion.</p>

<h4 id="algorithm">Algorithm</h4>

<ul>
  <li><strong>Token Bucket</strong>: Fixed capacity with continuous refill</li>
  <li><strong>Per-Operation Limits</strong>: Different limits for different operations</li>
  <li><strong>Request Queuing</strong>: Automatic waiting when bucket empty</li>
</ul>

<h4 id="configuration-2">Configuration</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">AirsRateLimiterConfig</span> <span class="p">{</span>
    <span class="nl">enabled</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>           <span class="c1">// Enable rate limiting (default: true)</span>
    <span class="nl">scanRequestsPerMinute</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>    <span class="c1">// Scan limit (default: 100)</span>
    <span class="nl">reportRequestsPerMinute</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>  <span class="c1">// Report limit (default: 50)</span>
    <span class="nl">resultRequestsPerMinute</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>  <span class="c1">// Result limit (default: 200)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="operation-types">Operation Types</h4>

<table>
  <thead>
    <tr>
      <th>Operation</th>
      <th>Default Limit</th>
      <th>Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">scan</code></td>
      <td>100/min</td>
      <td>Content scanning</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">report</code></td>
      <td>50/min</td>
      <td>Threat reports</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">result</code></td>
      <td>200/min</td>
      <td>Result retrieval</td>
    </tr>
  </tbody>
</table>

<h3 id="4-enhanced-client-indexts">4. Enhanced Client (index.ts)</h3>

<p>Orchestration layer combining all features into a unified interface.</p>

<h4 id="features-1">Features</h4>

<ul>
  <li><strong>Automatic Caching</strong>: Transparent response caching</li>
  <li><strong>Rate Limit Management</strong>: Automatic request throttling</li>
  <li><strong>Unified API</strong>: Single interface for all operations</li>
  <li><strong>Graceful Degradation</strong>: Works without cache/rate limiter</li>
</ul>

<h4 id="usage-example">Usage Example</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EnhancedPrismaAirsClient</span><span class="p">({</span>
    <span class="na">apiUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://api.aisecurity.paloaltonetworks.com</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AIRS_API_KEY</span><span class="p">,</span>
    <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">ttlSeconds</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
        <span class="na">maxSize</span><span class="p">:</span> <span class="mi">1000</span>
    <span class="p">},</span>
    <span class="na">rateLimiter</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">scanRequestsPerMinute</span><span class="p">:</span> <span class="mi">100</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Automatic caching and rate limiting</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">({</span>
    <span class="na">prompt</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Check this content</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">profile_name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">strict</span><span class="dl">'</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="5-factory-pattern-factoryts">5. Factory Pattern (factory.ts)</h3>

<p>Singleton factory ensuring single client instance per configuration.</p>

<h4 id="purpose">Purpose</h4>

<ul>
  <li><strong>Resource Efficiency</strong>: Reuses connections and caches</li>
  <li><strong>Consistency</strong>: Same client across application</li>
  <li><strong>Configuration Management</strong>: Centralizes client setup</li>
</ul>

<h4 id="implementation">Implementation</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">PrismaAirsClientFactory</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nx">instance</span><span class="p">?:</span> <span class="nx">EnhancedPrismaAirsClient</span><span class="p">;</span>

    <span class="k">static</span> <span class="nx">getInstance</span><span class="p">(</span><span class="nx">config</span><span class="p">?:</span> <span class="nx">AirsEnhancedClientConfig</span><span class="p">):</span> <span class="nx">EnhancedPrismaAirsClient</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Configuration required for first initialization</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EnhancedPrismaAirsClient</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">reset</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">instance</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="type-system">Type System</h2>

<p>All types are centralized in <code class="language-plaintext highlighter-rouge">src/types/airs.ts</code> with consistent <code class="language-plaintext highlighter-rouge">Airs</code> prefixing:</p>

<h3 id="request-types">Request Types</h3>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsScanRequest</code></td>
      <td>Synchronous scan input</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsAsyncScanObject</code></td>
      <td>Async scan item</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsRequestOptions</code></td>
      <td>Request configuration</td>
    </tr>
  </tbody>
</table>

<h3 id="response-types">Response Types</h3>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsScanResponse</code></td>
      <td>Scan results</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsAsyncScanResponse</code></td>
      <td>Async operation status</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsScanIdResult</code></td>
      <td>Retrieved scan result</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsThreatScanReportObject</code></td>
      <td>Detailed threat report</td>
    </tr>
  </tbody>
</table>

<h3 id="configuration-types">Configuration Types</h3>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsClientConfig</code></td>
      <td>Base client settings</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsCacheConfig</code></td>
      <td>Cache settings</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsRateLimiterConfig</code></td>
      <td>Rate limit settings</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AirsEnhancedClientConfig</code></td>
      <td>Complete configuration</td>
    </tr>
  </tbody>
</table>

<h2 id="best-practices">Best Practices</h2>

<h3 id="1-use-the-factory">1. Use the Factory</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ✅ Good - Use factory for singleton</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">getAirsClient</span><span class="p">();</span>

<span class="c1">// ❌ Bad - Direct instantiation</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EnhancedPrismaAirsClient</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="2-handle-errors">2. Handle Errors</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">PrismaAirsApiError</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">===</span> <span class="mi">429</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle rate limiting</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle auth error</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-monitor-performance">3. Monitor Performance</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Get cache statistics</span>
<span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getCacheStats</span><span class="p">();</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache performance</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">hitRate</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">hitRate</span><span class="p">}</span><span class="s2">%`</span><span class="p">,</span>
    <span class="na">size</span><span class="p">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">size</span>
<span class="p">});</span>

<span class="c1">// Get rate limit status</span>
<span class="kd">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getRateLimitStatus</span><span class="p">();</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rate limit status</span><span class="dl">'</span><span class="p">,</span> <span class="nx">status</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="4-configure-appropriately">4. Configure Appropriately</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Production configuration</span>
<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">AirsEnhancedClientConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">apiUrl</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AIRS_API_URL</span><span class="p">,</span>
    <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AIRS_API_KEY</span><span class="p">,</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
    <span class="na">maxRetries</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">ttlSeconds</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>      <span class="c1">// 5 minutes</span>
        <span class="na">maxSize</span><span class="p">:</span> <span class="mi">1000</span>
    <span class="p">},</span>
    <span class="na">rateLimiter</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">scanRequestsPerMinute</span><span class="p">:</span> <span class="mi">100</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="common-patterns">Common Patterns</h2>

<h3 id="batch-processing">Batch Processing</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Process multiple items with rate limiting</span>
<span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">content1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">content2</span><span class="dl">'</span><span class="p">,</span> <span class="p">...];</span>
<span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Rate limiter automatically throttles</span>
        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">({</span>
            <span class="na">prompt</span><span class="p">:</span> <span class="nx">item</span><span class="p">,</span>
            <span class="na">profile_name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">default</span><span class="dl">'</span>
        <span class="p">});</span>
        <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Scan failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="p">,</span> <span class="nx">error</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="cache-warming">Cache Warming</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Pre-populate cache with common requests</span>
<span class="kd">const</span> <span class="nx">commonPrompts</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span><span class="p">,</span> <span class="p">...];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">prompt</span> <span class="k">of</span> <span class="nx">commonPrompts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">({</span><span class="nx">prompt</span><span class="p">,</span> <span class="na">profile_name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">default</span><span class="dl">'</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="graceful-degradation">Graceful Degradation</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Disable features in development</span>
<span class="kd">const</span> <span class="nx">isDev</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">AirsEnhancedClientConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// ... base config</span>
    <span class="na">cache</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="o">!</span><span class="nx">isDev</span><span class="p">,</span>  <span class="c1">// Disable in dev for fresh results</span>
        <span class="na">ttlSeconds</span><span class="p">:</span> <span class="mi">300</span>
    <span class="p">},</span>
    <span class="na">rateLimiter</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>    <span class="c1">// Always enable to respect API limits</span>
        <span class="na">scanRequestsPerMinute</span><span class="p">:</span> <span class="nx">isDev</span> <span class="p">?</span> <span class="mi">10</span> <span class="p">:</span> <span class="mi">100</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues</h3>

<ol>
  <li>
    <p><strong>Authentication Failures</strong></p>

    <ul>
      <li>Verify <code class="language-plaintext highlighter-rouge">AIRS_API_KEY</code> is set correctly</li>
      <li>Check API key permissions</li>
      <li>Ensure <code class="language-plaintext highlighter-rouge">x-pan-token</code> header is sent</li>
    </ul>
  </li>
  <li>
    <p><strong>Rate Limiting</strong></p>

    <ul>
      <li>Monitor rate limit status</li>
      <li>Adjust limits based on quota</li>
      <li>Implement backoff strategies</li>
    </ul>
  </li>
  <li>
    <p><strong>Cache Misses</strong></p>

    <ul>
      <li>Check TTL configuration</li>
      <li>Monitor cache size</li>
      <li>Verify key generation</li>
    </ul>
  </li>
  <li>
    <p><strong>Timeout Errors</strong></p>
    <ul>
      <li>Increase timeout for large payloads</li>
      <li>Check network connectivity</li>
      <li>Monitor API response times</li>
    </ul>
  </li>
</ol>

<h3 id="debug-logging">Debug Logging</h3>

<p>Enable debug logs for troubleshooting:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug npm start
</code></pre></div></div>

<h2 id="performance-optimization">Performance Optimization</h2>

<h3 id="cache-tuning">Cache Tuning</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Monitor and adjust cache size</span>
<span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getCacheStats</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">evictions</span> <span class="o">&gt;</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">hits</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Too many evictions, increase cache size</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="rate-limit-optimization">Rate Limit Optimization</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Adjust limits based on usage patterns</span>
<span class="kd">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getRateLimitStatus</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">status</span><span class="p">.</span><span class="nx">scan</span><span class="p">.</span><span class="nx">available</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Near limit, slow down requests</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="integration-with-mcp">Integration with MCP</h2>

<p>The AIRS client is primarily used by the Tools handler to execute security scans:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// In src/tools/index.ts</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">getAirsClient</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">scanSync</span><span class="p">({</span>
    <span class="na">prompt</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">prompt</span><span class="p">,</span>
    <span class="na">response</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">response</span><span class="p">,</span>
    <span class="na">profile_name</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">profile</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">default</span><span class="dl">'</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li><a href="/developers/src/tools/">Tools Module</a> - See how tools use the AIRS client</li>
  <li><a href="/developers/src/config/">Configuration Module</a> - Understand configuration management</li>
  <li><a href="/developers/src/types/">Types Module</a> - Explore type definitions</li>
</ul>

      </article>
      
      <div class="content-footer">
        <div class="edit-page">
          <a href="https://github.com/cdot65/prisma-airs-mcp/edit/main/docs/_developers/src/airs.md">
            <i class="fas fa-edit"></i> Edit this page on GitHub
          </a>
        </div>
        
        
        <div class="pagination">
          
          
          <a href="/developers/src/config/" class="next">
            Configuration Module <i class="fas fa-arrow-right"></i>
          </a>
          
        </div>
        
      </div>
    </main>
    
    <aside class="toc">
      <h4>On this page</h4>
      <nav id="table-of-contents"></nav>
    </aside>
  </div>

  <!-- Syntax highlighting is handled by Jekyll Rouge -->
  <script src="/assets/js/main.js"></script>
</body>
</html>