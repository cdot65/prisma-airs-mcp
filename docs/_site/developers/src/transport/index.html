<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transport Module (src/transport/) | Prisma AIRS MCP</title>
  <meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection">
  
  <!-- SEO Tags -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Transport Module (src/transport/) | Prisma AIRS MCP</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Transport Module (src/transport/)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Transport Module Documentation" />
<meta property="og:description" content="Transport Module Documentation" />
<link rel="canonical" href="http://localhost:4000/developers/src/transport/" />
<meta property="og:url" content="http://localhost:4000/developers/src/transport/" />
<meta property="og:site_name" content="Prisma AIRS MCP" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Transport Module (src/transport/)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Transport Module Documentation","headline":"Transport Module (src/transport/)","url":"http://localhost:4000/developers/src/transport/"}</script>
<!-- End Jekyll SEO tag -->

  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Rouge syntax highlighting is handled by Jekyll -->
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a href="/" class="navbar-logo">
          <i class="fas fa-shield-alt"></i>
          Prisma AIRS MCP
        </a>
      </div>
      <div class="navbar-menu">
        <a href="/deployment" class="navbar-item ">Deployment</a>
        <a href="/developers" class="navbar-item active">Developers</a>
        <a href="/prisma-airs/overview" class="navbar-item ">Prisma AIRS</a>
        <a href="https://github.com/cdot65/prisma-airs-mcp" class="navbar-item">
          <i class="fab fa-github"></i>
        </a>
      </div>
    </div>
  </nav>

  <div class="documentation-layout">
    <aside class="sidebar">
      
<nav class="sidebar-nav">
  <h4>Getting Started</h4>
  <ul>
    <li><a href="/developers/overview/" >Overview</a></li>
  </ul>
  
  <h4>Source Code Documentation</h4>
  <ul>
    <li><a href="/developers/src/" >Root (src/)</a></li>
    <li><a href="/developers/src/types/" >Types Module</a></li>
    <li><a href="/developers/src/airs/" >AIRS Module</a></li>
    <li><a href="/developers/src/config/" >Configuration</a></li>
    <li><a href="/developers/src/prompts/" >Prompts</a></li>
    <li><a href="/developers/src/resources/" >Resources</a></li>
    <li><a href="/developers/src/tools/" >Tools</a></li>
    <li><a href="/developers/src/transport/" class="active">Transport</a></li>
    <li><a href="/developers/src/utils/" >Utilities</a></li>
  </ul>
  
  <h4>API</h4>
  <ul>
    <li><a href="/developers/api/" >API Reference</a></li>
  </ul>
</nav>



<style>
.sidebar-nav {
  padding: var(--spacing-md);
}

.sidebar-nav h4 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--gray);
  margin-bottom: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

.sidebar-nav h4:first-child {
  margin-top: 0;
}

.sidebar-nav ul {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--spacing-md) 0;
}

.sidebar-nav li {
  margin-bottom: var(--spacing-xs);
}

.sidebar-nav a {
  display: block;
  padding: var(--spacing-xs) var(--spacing-sm);
  color: var(--dark);
  border-radius: var(--border-radius);
  font-size: 0.9375rem;
  transition: all 0.2s ease;
}

.sidebar-nav a:hover {
  background-color: var(--gray-light);
  text-decoration: none;
}

.sidebar-nav a.active {
  background-color: var(--primary);
  color: var(--white);
  font-weight: 500;
}

.sidebar-nav a.active:hover {
  background-color: var(--primary-dark);
}
</style>
    </aside>
    
    <main class="documentation-content">
      <div class="content-header">
        <h1>Transport Module (src/transport/)</h1>
        
      </div>
      
      <article class="content">
        <h1 id="transport-module-documentation">Transport Module Documentation</h1>

<p>The transport module handles HTTP and Server-Sent Events (SSE) communication for the MCP server. It implements the JSON-RPC 2.0 protocol over HTTP with optional SSE streaming for long-running operations.</p>

<h2 id="module-overview">Module Overview</h2>

<p>The transport module consists of three files:</p>

<ul>
  <li><strong>http.ts</strong> - Main HTTP transport handler with JSON-RPC routing</li>
  <li><strong>sse.ts</strong> - Server-Sent Events implementation for streaming responses</li>
  <li><strong>prompt.md</strong> - Prompt engineering guidelines (documentation)</li>
</ul>

<h2 id="http-transport-httpts">HTTP Transport (http.ts)</h2>

<h3 id="overview">Overview</h3>

<p>The HTTP transport handles incoming MCP requests, routes them to appropriate handlers, and manages client sessions for streaming responses.</p>

<h3 id="key-components">Key Components</h3>

<h4 id="httpservertransport-class">HttpServerTransport Class</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">HttpServerTransport</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">Server</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">logger</span><span class="p">:</span> <span class="nx">Logger</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">resourceHandler</span><span class="p">:</span> <span class="nx">ResourceHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">toolHandler</span><span class="p">:</span> <span class="nx">ToolHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">promptHandler</span><span class="p">:</span> <span class="nx">PromptHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">sseTransport</span><span class="p">:</span> <span class="nx">SSETransport</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">sessions</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">{</span> <span class="na">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">createdAt</span><span class="p">:</span> <span class="nb">Date</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="c1">// Handle incoming JSON-RPC requests</span>
    <span class="k">async</span> <span class="nx">handleRequest</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">StreamableRequest</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="c1">// Handle SSE connections for streaming</span>
    <span class="nx">handleSSEConnection</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">StreamableRequest</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

    <span class="c1">// Route requests to appropriate handlers</span>
    <span class="k">private</span> <span class="k">async</span> <span class="nx">routeRequest</span><span class="p">(</span>
        <span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="nx">params</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">,</span>
    <span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="json-rpc-implementation">JSON-RPC Implementation</h3>

<h4 id="request-format">Request Format</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">JsonRpcRequest</span> <span class="p">{</span>
    <span class="nl">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">params</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="response-format">Response Format</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">JsonRpcResponse</span> <span class="p">{</span>
    <span class="nl">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">result</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
    <span class="nl">error</span><span class="p">?:</span> <span class="nx">JsonRpcError</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">JsonRpcError</span> <span class="p">{</span>
    <span class="nl">code</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="supported-methods">Supported Methods</h3>

<p>The transport routes the following MCP methods:</p>

<h4 id="resource-methods">Resource Methods</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">resources/list</code> - List available resources</li>
  <li><code class="language-plaintext highlighter-rouge">resources/read</code> - Read resource content</li>
  <li><code class="language-plaintext highlighter-rouge">resources/templates/list</code> - List resource URI templates</li>
</ul>

<h4 id="tool-methods">Tool Methods</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tools/list</code> - List available tools</li>
  <li><code class="language-plaintext highlighter-rouge">tools/call</code> - Execute a tool</li>
</ul>

<h4 id="prompt-methods">Prompt Methods</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">prompts/list</code> - List available prompts</li>
  <li><code class="language-plaintext highlighter-rouge">prompts/get</code> - Get prompt with arguments</li>
</ul>

<h4 id="server-methods">Server Methods</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">initialize</code> - Initialize MCP connection</li>
  <li><code class="language-plaintext highlighter-rouge">ping</code> - Health check</li>
  <li><code class="language-plaintext highlighter-rouge">notifications/initialized</code> - Client initialized notification</li>
  <li><code class="language-plaintext highlighter-rouge">completion/complete</code> - Completion support (MCP Inspector compatibility)</li>
</ul>

<h3 id="session-management">Session Management</h3>

<p>Sessions enable streaming responses via SSE:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nx">getOrCreateSession</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">StreamableRequest</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">existingSessionId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">mcp-session-id</span><span class="dl">'</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">existingSessionId</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">existingSessionId</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">existingSessionId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="nx">uuidv4</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="nx">uuidv4</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">,</span> <span class="p">{</span> <span class="nx">clientId</span><span class="p">,</span> <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">});</span>

    <span class="k">return</span> <span class="nx">sessionId</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="request-routing">Request Routing</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">async</span> <span class="nx">routeRequest</span><span class="p">(</span><span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">params</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">resources/list</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">resourceHandler</span><span class="p">.</span><span class="nx">listResources</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">toolHandler</span><span class="p">.</span><span class="nx">callTool</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
        <span class="c1">// ... other methods</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Method not found: </span><span class="p">${</span><span class="nx">method</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="error-handling">Error Handling</h3>

<p>Standard JSON-RPC error codes:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Invalid request</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">code</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">32600</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid Request: missing or invalid method</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>

<span class="c1">// Internal error</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">code</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">32603</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal error</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Error details</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">request-id</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sse-transport-ssets">SSE Transport (sse.ts)</h2>

<h3 id="overview-1">Overview</h3>

<p>The SSE transport enables server-to-client streaming for long-running operations and real-time updates.</p>

<h3 id="ssetransport-class">SSETransport Class</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">SSETransport</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">clients</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">Response</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">private</span> <span class="nx">messageId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Initialize SSE connection</span>
    <span class="nx">initializeSSE</span><span class="p">(</span><span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

    <span class="c1">// Send SSE event</span>
    <span class="nx">sendEvent</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">message</span><span class="p">:</span> <span class="nx">SSEMessage</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="c1">// Send JSON-RPC response via SSE</span>
    <span class="nx">sendJsonRpcResponse</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">response</span><span class="p">:</span> <span class="nx">JsonRpcResponse</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="c1">// Send server notification</span>
    <span class="nx">sendNotification</span><span class="p">(</span>
        <span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="nx">params</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">,</span>
    <span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="c1">// Broadcast to all clients</span>
    <span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="nx">SSEMessage</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="sse-message-format">SSE Message Format</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">SSEMessage</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span> <span class="c1">// Message ID for reconnection</span>
    <span class="nl">event</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span> <span class="c1">// Event type</span>
    <span class="nl">data</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="c1">// Message data (JSON string)</span>
    <span class="nl">retry</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span> <span class="c1">// Reconnection retry interval</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="sse-event-types">SSE Event Types</h3>

<ol>
  <li><strong>connect</strong> - Initial connection confirmation</li>
  <li><strong>message</strong> - JSON-RPC response</li>
  <li><strong>notification</strong> - Server-initiated notification</li>
  <li><strong>endpoint</strong> - Legacy endpoint information</li>
</ol>

<h3 id="sse-headers">SSE Headers</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache-Control</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no-cache</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connection</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">keep-alive</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-Accel-Buffering</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// Disable Nginx buffering</span>
</code></pre></div></div>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="basic-request-handling">Basic Request Handling</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Express route handler</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/messages</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">transport</span><span class="p">.</span><span class="nx">handleRequest</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="sse-connection">SSE Connection</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SSE endpoint for streaming</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/sse</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">transport</span><span class="p">.</span><span class="nx">handleSSEConnection</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="client-request-example">Client Request Example</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// JSON-RPC request</span>
<span class="nx">POST</span> <span class="o">/</span><span class="nx">messages</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tools/call</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">params</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">airs_scan_content</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">arguments</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">prompt</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Scan this content</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">req-123</span><span class="dl">"</span>
<span class="p">}</span>

<span class="c1">// Response</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Scan completed successfully</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">req-123</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="sse-streaming-example">SSE Streaming Example</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Client connects with SSE</span>
<span class="nx">GET</span> <span class="o">/</span><span class="nx">sse</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">event</span><span class="o">-</span><span class="nx">stream</span>

<span class="c1">// Server sends events</span>
<span class="nx">event</span><span class="p">:</span> <span class="nx">connect</span>
<span class="nx">data</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">connected</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span>

<span class="nl">event</span><span class="p">:</span> <span class="nx">message</span>
<span class="nx">id</span><span class="p">:</span> <span class="mi">1</span>
<span class="nx">data</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">:{...},</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">req-123</span><span class="dl">"</span><span class="p">}</span>

<span class="nl">event</span><span class="p">:</span> <span class="nx">notification</span>
<span class="nx">data</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">jsonrpc</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2.0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">tools/list_changed</span><span class="dl">"</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="integration-points">Integration Points</h2>

<h3 id="handler-integration">Handler Integration</h3>

<p>The transport integrates with:</p>

<ol>
  <li><strong>ResourceHandler</strong> - Resource operations</li>
  <li><strong>ToolHandler</strong> - Tool execution</li>
  <li><strong>PromptHandler</strong> - Prompt retrieval</li>
  <li><strong>Config</strong> - Server configuration</li>
  <li><strong>Logger</strong> - Request logging</li>
</ol>

<h3 id="initialize-response">Initialize Response</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">protocolVersion</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2024-11-05</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">capabilities</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">resources</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">read</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="dl">"</span><span class="s2">tools</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">call</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="dl">"</span><span class="s2">prompts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="dl">"</span><span class="s2">get</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">serverInfo</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">prisma-airs-mcp</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.0.0</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="resource-templates">Resource Templates</h3>

<p>Dynamic resource URI templates:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">resourceTemplates</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">uriTemplate</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">airs://scan-results/{scanId}</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Scan Results</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Retrieve results for a specific scan by ID</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">mimeType</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<ol>
  <li><strong>Session Management</strong> - Sessions are ephemeral and tied to connections</li>
  <li><strong>Input Validation</strong> - JSON-RPC requests are validated</li>
  <li><strong>Error Handling</strong> - Errors don’t expose internal details</li>
  <li><strong>CORS</strong> - Should be configured at Express level</li>
  <li><strong>Authentication</strong> - Handled by AIRS API key in handlers</li>
</ol>

<h2 id="performance-optimization">Performance Optimization</h2>

<h3 id="streaming-decision">Streaming Decision</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nx">shouldStreamResponse</span><span class="p">(</span><span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">result</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">streamableMethods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span>      <span class="c1">// Long-running operations</span>
        <span class="dl">'</span><span class="s1">resources/read</span><span class="dl">'</span><span class="p">,</span>  <span class="c1">// Large resources</span>
    <span class="p">];</span>

    <span class="k">return</span> <span class="nx">streamableMethods</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">method</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="connection-management">Connection Management</h3>

<ul>
  <li>SSE connections are cleaned up on disconnect</li>
  <li>Broadcast operations skip disconnected clients</li>
  <li>Sessions are memory-based (consider Redis for scale)</li>
</ul>

<h2 id="error-codes">Error Codes</h2>

<p>Standard JSON-RPC 2.0 error codes:</p>

<table>
  <thead>
    <tr>
      <th>Code</th>
      <th>Message</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-32700</td>
      <td>Parse error</td>
      <td>Invalid JSON</td>
    </tr>
    <tr>
      <td>-32600</td>
      <td>Invalid Request</td>
      <td>Invalid request structure</td>
    </tr>
    <tr>
      <td>-32601</td>
      <td>Method not found</td>
      <td>Unknown method</td>
    </tr>
    <tr>
      <td>-32602</td>
      <td>Invalid params</td>
      <td>Invalid method parameters</td>
    </tr>
    <tr>
      <td>-32603</td>
      <td>Internal error</td>
      <td>Server error</td>
    </tr>
  </tbody>
</table>

<h2 id="testing">Testing</h2>

<h3 id="unit-testing">Unit Testing</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Test request routing</span>
<span class="kd">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpServerTransport</span><span class="p">({</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">logger</span> <span class="p">});</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">transport</span><span class="p">.</span><span class="nx">routeRequest</span><span class="p">(</span><span class="dl">'</span><span class="s1">tools/list</span><span class="dl">'</span><span class="p">,</span> <span class="p">{});</span>
<span class="nx">assert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">tools</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="integration-testing">Integration Testing</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Test full request flow</span>
<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/messages</span><span class="dl">'</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span>
    <span class="na">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-1</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">jsonrpc</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">test-1</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues</h3>

<ol>
  <li><strong>SSE Connection Drops</strong>
    <ul>
      <li>Check proxy/load balancer timeout settings</li>
      <li>Ensure X-Accel-Buffering header is set</li>
      <li>Implement heartbeat/keepalive</li>
    </ul>
  </li>
  <li><strong>Session Not Found</strong>
    <ul>
      <li>Sessions are in-memory only</li>
      <li>Check Mcp-Session-Id header</li>
      <li>Verify session creation logic</li>
    </ul>
  </li>
  <li><strong>Method Not Found</strong>
    <ul>
      <li>Verify method name spelling</li>
      <li>Check handler registration</li>
      <li>Review routeRequest switch statement</li>
    </ul>
  </li>
</ol>

<h2 id="best-practices">Best Practices</h2>

<ol>
  <li><strong>Always validate JSON-RPC structure</strong> before processing</li>
  <li><strong>Use appropriate error codes</strong> for different failure scenarios</li>
  <li><strong>Log requests with context</strong> for debugging</li>
  <li><strong>Clean up resources</strong> on disconnect</li>
  <li><strong>Consider rate limiting</strong> at transport level</li>
  <li><strong>Implement request timeouts</strong> for long operations</li>
</ol>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li><a href="/developers/src/">Server Root</a> - Express server setup</li>
  <li><a href="/developers/src/tools/">Tools Module</a> - Tool handler implementation</li>
  <li><a href="/developers/src/resources/">Resources Module</a> - Resource handler implementation</li>
  <li><a href="/developers/src/types/">MCP Types</a> - Protocol type definitions</li>
</ul>

      </article>
      
      <div class="content-footer">
        <div class="edit-page">
          <a href="https://github.com/cdot65/prisma-airs-mcp/edit/main/docs/_developers/src/transport.md">
            <i class="fas fa-edit"></i> Edit this page on GitHub
          </a>
        </div>
        
        
        <div class="pagination">
          
          
          <a href="/developers/src/types/" class="next">
            Types Module (src/types/) <i class="fas fa-arrow-right"></i>
          </a>
          
        </div>
        
      </div>
    </main>
    
    <aside class="toc">
      <h4>On this page</h4>
      <nav id="table-of-contents"></nav>
    </aside>
  </div>

  <!-- Syntax highlighting is handled by Jekyll Rouge -->
  <script src="/assets/js/main.js"></script>
</body>
</html>