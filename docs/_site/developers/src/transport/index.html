<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transport Module | Prisma AIRS MCP</title>
  <meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection">
  
  <!-- SEO Tags -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Transport Module | Prisma AIRS MCP</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Transport Module" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="HTTP Transport Layer (src/transport/)" />
<meta property="og:description" content="HTTP Transport Layer (src/transport/)" />
<link rel="canonical" href="http://localhost:4000/developers/src/transport/" />
<meta property="og:url" content="http://localhost:4000/developers/src/transport/" />
<meta property="og:site_name" content="Prisma AIRS MCP" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Transport Module" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"HTTP Transport Layer (src/transport/)","headline":"Transport Module","url":"http://localhost:4000/developers/src/transport/"}</script>
<!-- End Jekyll SEO tag -->

  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Rouge syntax highlighting is handled by Jekyll -->
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a href="/" class="navbar-logo">
          <i class="fas fa-shield-alt"></i>
          Prisma AIRS MCP
        </a>
      </div>
      <div class="navbar-menu">
        <a href="/deployment" class="navbar-item ">Deployment</a>
        <a href="/developers" class="navbar-item active">Developers</a>
        <a href="/prisma-airs/overview" class="navbar-item ">Prisma AIRS</a>
        <a href="https://github.com/cdot65/prisma-airs-mcp" class="navbar-item">
          <i class="fab fa-github"></i>
        </a>
      </div>
    </div>
  </nav>

  <div class="documentation-layout">
    <aside class="sidebar">
      
<nav class="sidebar-nav">
  <h4>Getting Started</h4>
  <ul>
    <li><a href="/developers/overview/" >Overview</a></li>
  </ul>
  
  <h4>Source Code Documentation</h4>
  <ul>
    <li><a href="/developers/src/" >Root (src/)</a></li>
    <li><a href="/developers/src/types/" >Types Module</a></li>
    <li><a href="/developers/src/airs/" >AIRS Module</a></li>
    <li><a href="/developers/src/config/" >Configuration</a></li>
    <li><a href="/developers/src/prompts/" >Prompts</a></li>
    <li><a href="/developers/src/resources/" >Resources</a></li>
    <li><a href="/developers/src/tools/" >Tools</a></li>
    <li><a href="/developers/src/transport/" class="active">Transport</a></li>
    <li><a href="/developers/src/utils/" >Utilities</a></li>
  </ul>
  
  <h4>API</h4>
  <ul>
    <li><a href="/developers/api/" >API Reference</a></li>
  </ul>
  
  <h4>Release Notes</h4>
  <ul>
    <li><a href="/developers/release-notes/" >Version History</a></li>
  </ul>
</nav>



<style>
.sidebar-nav {
  padding: var(--spacing-md);
}

.sidebar-nav h4 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--gray);
  margin-bottom: var(--spacing-sm);
  margin-top: var(--spacing-lg);
}

.sidebar-nav h4:first-child {
  margin-top: 0;
}

.sidebar-nav ul {
  list-style: none;
  padding: 0;
  margin: 0 0 var(--spacing-md) 0;
}

.sidebar-nav li {
  margin-bottom: var(--spacing-xs);
}

.sidebar-nav a {
  display: block;
  padding: var(--spacing-xs) var(--spacing-sm);
  color: var(--dark);
  border-radius: var(--border-radius);
  font-size: 0.9375rem;
  transition: all 0.2s ease;
}

.sidebar-nav a:hover {
  background-color: var(--gray-light);
  text-decoration: none;
}

.sidebar-nav a.active {
  background-color: var(--primary);
  color: var(--white);
  font-weight: 500;
}

.sidebar-nav a.active:hover {
  background-color: var(--primary-dark);
}
</style>
    </aside>
    
    <main class="documentation-content">
      <div class="content-header">
        <h1>Transport Module</h1>
        
      </div>
      
      <article class="content">
        <h1 id="http-transport-layer-srctransport">HTTP Transport Layer (src/transport/)</h1>

<p>The transport module implements the HTTP and Server-Sent Events (SSE) transport layer for the MCP server. It handles JSON-RPC 2.0 protocol communication, request routing, session management, and optional streaming responses.</p>

<h2 id="module-structure">Module Structure</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/transport/
├── http.ts    # Main HTTP transport with JSON-RPC routing
└── sse.ts     # Server-Sent Events for streaming responses
</code></pre></div></div>

<h2 id="architecture-overview">Architecture Overview</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────┐
│        HTTP Client Request              │
│     (JSON-RPC 2.0 over HTTP)            │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│      HttpServerTransport                │
│  • Request validation                   │
│  • Session management                   │
│  • Method routing                       │
│  • Response formatting                  │
└────┬────────────┴──────────┬────────────┘
     │ Standard Response     │ Streaming
     │                       │
     ▼                       ▼
┌──────────────┐       ┌──────────────────┐
│ JSON Response│       │   SSETransport   │
│  (immediate) │       │ (event stream)   │
└──────────────┘       └──────────────────┘
</code></pre></div></div>

<h2 id="core-components">Core Components</h2>

<h3 id="1-httpservertransport-httpts">1. HttpServerTransport (http.ts)</h3>

<p>The main transport handler that processes incoming requests and routes them to appropriate MCP handlers.</p>

<h4 id="class-structure">Class Structure</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">HttpServerTransport</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">Server</span><span class="p">;</span>              <span class="c1">// MCP SDK server instance</span>
    <span class="k">private</span> <span class="nx">logger</span><span class="p">:</span> <span class="nx">Logger</span><span class="p">;</span>              <span class="c1">// Winston logger</span>
    <span class="k">private</span> <span class="nx">resourceHandler</span><span class="p">:</span> <span class="nx">ResourceHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">toolHandler</span><span class="p">:</span> <span class="nx">ToolHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">promptHandler</span><span class="p">:</span> <span class="nx">PromptHandler</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">getConfig</span><span class="p">();</span>
    <span class="k">private</span> <span class="nx">sseTransport</span><span class="p">:</span> <span class="nx">SSETransport</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">sessions</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">{</span> <span class="na">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">createdAt</span><span class="p">:</span> <span class="nb">Date</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">TransportHttpOptions</span><span class="p">);</span>

    <span class="k">async</span> <span class="nx">handleRequest</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">TransportStreamableRequest</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="nx">handleSSEConnection</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">TransportStreamableRequest</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="key-responsibilities">Key Responsibilities</h4>

<ol>
  <li><strong>Request Validation</strong>: Ensures valid JSON-RPC 2.0 format</li>
  <li><strong>Method Routing</strong>: Routes requests to appropriate handlers</li>
  <li><strong>Session Management</strong>: Tracks client sessions for streaming</li>
  <li><strong>Response Mode Selection</strong>: Chooses between standard JSON or SSE</li>
  <li><strong>Error Handling</strong>: Formats errors according to JSON-RPC spec</li>
</ol>

<h3 id="2-ssetransport-ssets">2. SSETransport (sse.ts)</h3>

<p>Manages Server-Sent Events connections for streaming responses.</p>

<h4 id="class-structure-1">Class Structure</h4>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">SSETransport</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">clients</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">Response</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">messageId</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

    <span class="nx">initializeSSE</span><span class="p">(</span><span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

    <span class="nx">sendEvent</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">message</span><span class="p">:</span> <span class="nx">TransportSSEMessage</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">sendJsonRpcResponse</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">response</span><span class="p">:</span> <span class="nx">TransportJsonRpcResponse</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">sendNotification</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">params</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">broadcast</span><span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="nx">TransportSSEMessage</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

    <span class="nx">isConnected</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">disconnect</span><span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="request-flow">Request Flow</h2>

<h3 id="1-standard-json-rpc-request">1. Standard JSON-RPC Request</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client → POST / → handleRequest() → routeRequest() → Handler → JSON Response
</code></pre></div></div>

<h3 id="2-streaming-sse-request">2. Streaming SSE Request</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client → GET / (Accept: text/event-stream) → handleSSEConnection() → SSE Stream
       → POST / → handleRequest() → routeRequest() → Handler → SSE Events
</code></pre></div></div>

<h2 id="supported-methods">Supported Methods</h2>

<h3 id="resource-methods">Resource Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Handler</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">resources/list</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleResourcesList()</code></td>
      <td>List available resources</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">resources/read</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleResourcesRead()</code></td>
      <td>Read resource content</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">resources/templates/list</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleResourceTemplatesList()</code></td>
      <td>List URI templates</td>
    </tr>
  </tbody>
</table>

<h3 id="tool-methods">Tool Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Handler</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">tools/list</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleToolsList()</code></td>
      <td>List available tools</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">tools/call</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleToolsCall()</code></td>
      <td>Execute a tool</td>
    </tr>
  </tbody>
</table>

<h3 id="prompt-methods">Prompt Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Handler</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">prompts/list</code></td>
      <td><code class="language-plaintext highlighter-rouge">handlePromptsList()</code></td>
      <td>List available prompts</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">prompts/get</code></td>
      <td><code class="language-plaintext highlighter-rouge">handlePromptsGet()</code></td>
      <td>Get prompt with arguments</td>
    </tr>
  </tbody>
</table>

<h3 id="system-methods">System Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Handler</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">initialize</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleInitialize()</code></td>
      <td>Initialize MCP session</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ping</code></td>
      <td><code class="language-plaintext highlighter-rouge">handlePing()</code></td>
      <td>Health check</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">notifications/initialized</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleNotificationsInitialized()</code></td>
      <td>Client ready notification</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">completion/complete</code></td>
      <td><code class="language-plaintext highlighter-rouge">handleCompletionComplete()</code></td>
      <td>MCP Inspector compatibility</td>
    </tr>
  </tbody>
</table>

<h2 id="type-system">Type System</h2>

<p>All transport types are centralized in <code class="language-plaintext highlighter-rouge">src/types/transport.ts</code>:</p>

<h3 id="requestresponse-types">Request/Response Types</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">TransportJsonRpcRequest</span> <span class="p">{</span>
    <span class="nl">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">params</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">TransportJsonRpcResponse</span> <span class="p">{</span>
    <span class="nl">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">result</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
    <span class="nl">error</span><span class="p">?:</span> <span class="nx">TransportJsonRpcError</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">TransportJsonRpcError</span> <span class="p">{</span>
    <span class="nl">code</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">?:</span> <span class="nx">unknown</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="sse-types">SSE Types</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">TransportSSEMessage</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>      <span class="c1">// Message ID for reconnection</span>
    <span class="nl">event</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>   <span class="c1">// Event type</span>
    <span class="nl">data</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>     <span class="c1">// Message data (JSON string)</span>
    <span class="nl">retry</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>   <span class="c1">// Reconnection retry interval</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">TransportStreamableRequest</span> <span class="kd">extends</span> <span class="nx">Request</span> <span class="p">{</span>
    <span class="nl">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">accept</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="dl">'</span><span class="s1">last-event-id</span><span class="dl">'</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="dl">'</span><span class="s1">mcp-session-id</span><span class="dl">'</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">}</span> <span class="o">&amp;</span> <span class="nx">Request</span><span class="p">[</span><span class="dl">'</span><span class="s1">headers</span><span class="dl">'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="session-management">Session Management</h2>

<p>Sessions enable stateful connections for streaming responses:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nx">getOrCreateSession</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">TransportStreamableRequest</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">existingSessionId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">mcp-session-id</span><span class="dl">'</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">existingSessionId</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">existingSessionId</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">existingSessionId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="nx">uuidv4</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="nx">uuidv4</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">,</span> <span class="p">{</span><span class="nx">clientId</span><span class="p">,</span> <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>

    <span class="k">return</span> <span class="nx">sessionId</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Session Headers</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Mcp-Session-Id</code>: Unique session identifier</li>
  <li><code class="language-plaintext highlighter-rouge">Last-Event-Id</code>: For SSE reconnection</li>
</ul>

<h2 id="response-mode-selection">Response Mode Selection</h2>

<p>The transport automatically selects the appropriate response mode:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nx">shouldStreamResponse</span><span class="p">(</span><span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">result</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="c1">// Currently returns false for all methods</span>
    <span class="c1">// Can be extended for long-running operations</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span>
<span class="nx">acceptsSSE</span><span class="p">(</span><span class="nx">req</span>
<span class="p">:</span>
<span class="nx">TransportStreamableRequest</span>
<span class="p">):</span>
<span class="nx">boolean</span>
<span class="p">{</span>
    <span class="kd">const</span> <span class="nx">accept</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">accept</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">accept</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sse-implementation">SSE Implementation</h2>

<h3 id="connection-setup">Connection Setup</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Set SSE headers</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache-Control</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no-cache</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connection</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">keep-alive</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-Accel-Buffering</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// Disable Nginx buffering</span>
</code></pre></div></div>

<h3 id="event-format">Event Format</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>event: message
id: 123
data: {"jsonrpc":"2.0","result":{...},"id":"req-123"}

event: notification
data: {"jsonrpc":"2.0","method":"tools/list_changed"}

</code></pre></div></div>

<h3 id="event-types">Event Types</h3>

<table>
  <thead>
    <tr>
      <th>Event</th>
      <th>Purpose</th>
      <th>Payload</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">connect</code></td>
      <td>Initial connection</td>
      <td><code class="language-plaintext highlighter-rouge">{ connected: true }</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">endpoint</code></td>
      <td>Legacy compatibility</td>
      <td><code class="language-plaintext highlighter-rouge">{ endpoint: '/messages' }</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">message</code></td>
      <td>JSON-RPC response</td>
      <td>Full JSON-RPC response</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">notification</code></td>
      <td>Server notification</td>
      <td>JSON-RPC notification</td>
    </tr>
  </tbody>
</table>

<h2 id="error-handling">Error Handling</h2>

<h3 id="json-rpc-error-codes">JSON-RPC Error Codes</h3>

<table>
  <thead>
    <tr>
      <th>Code</th>
      <th>Constant</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-32700</td>
      <td>Parse error</td>
      <td>Invalid JSON</td>
    </tr>
    <tr>
      <td>-32600</td>
      <td>Invalid Request</td>
      <td>Missing/invalid method</td>
    </tr>
    <tr>
      <td>-32601</td>
      <td>Method not found</td>
      <td>Unknown method</td>
    </tr>
    <tr>
      <td>-32602</td>
      <td>Invalid params</td>
      <td>Invalid parameters</td>
    </tr>
    <tr>
      <td>-32603</td>
      <td>Internal error</td>
      <td>Server error</td>
    </tr>
  </tbody>
</table>

<h3 id="error-response-format">Error Response Format</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">-32600</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid Request: missing or invalid method"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Additional error details"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"request-123"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="handler-implementations">Handler Implementations</h2>

<h3 id="initialize-handler">Initialize Handler</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">async</span>
<span class="nx">handleInitialize</span><span class="p">(</span><span class="nx">params</span>
<span class="p">:</span>
<span class="nx">unknown</span>
<span class="p">):</span>
<span class="nb">Promise</span> <span class="o">&lt;</span> <span class="nx">unknown</span> <span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">protocolVersion</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">protocolVersion</span><span class="p">,</span>
        <span class="na">capabilities</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">experimental</span><span class="p">:</span> <span class="p">{},</span>
            <span class="na">prompts</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">listChanged</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="na">resources</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">subscribe</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">listChanged</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="na">tools</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">listChanged</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="na">serverInfo</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverName</span><span class="p">,</span>
            <span class="na">version</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">mcp</span><span class="p">.</span><span class="nx">serverVersion</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="resource-templates-handler">Resource Templates Handler</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">async</span> <span class="nx">handleResourceTemplatesList</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">resourceTemplates</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">uriTemplate</span><span class="p">:</span> <span class="dl">'</span><span class="s1">airs://scan-results/{scanId}</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Scan Results</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Retrieve results for a specific scan by ID</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">mimeType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">uriTemplate</span><span class="p">:</span> <span class="dl">'</span><span class="s1">airs://threat-reports/{reportId}</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Threat Report</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Retrieve detailed threat report by ID</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">mimeType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="basic-json-rpc-request">Basic JSON-RPC Request</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost:3000/ <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 1
  }'</span>

<span class="c"># Response</span>
<span class="o">{</span>
    <span class="s2">"jsonrpc"</span>: <span class="s2">"2.0"</span>,
    <span class="s2">"result"</span>: <span class="o">{</span>
        <span class="s2">"tools"</span>: <span class="o">[</span>...]
    <span class="o">}</span>,
    <span class="s2">"id"</span>: 1
<span class="o">}</span>
</code></pre></div></div>

<h3 id="sse-connection">SSE Connection</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Establish SSE connection</span>
curl <span class="nt">-H</span> <span class="s2">"Accept: text/event-stream"</span> http://localhost:3000/

<span class="c"># Server sends:</span>
event: endpoint
data: <span class="o">{</span><span class="s2">"endpoint"</span>:<span class="s2">"/messages"</span><span class="o">}</span>

event: connect
data: <span class="o">{</span><span class="s2">"connected"</span>:true<span class="o">}</span>
</code></pre></div></div>

<h3 id="tool-execution">Tool Execution</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost:3000/ <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
        "name": "airs_scan_content",
        "arguments": {
            "prompt": "Check this content"
        }
    },
    "id": "scan-123"
  }'</span>
</code></pre></div></div>

<h2 id="performance-considerations">Performance Considerations</h2>

<h3 id="connection-management">Connection Management</h3>

<ul>
  <li>SSE connections are cleaned up on client disconnect</li>
  <li>Sessions are stored in-memory (consider Redis for scale)</li>
  <li>Automatic disconnection after response for non-persistent operations</li>
</ul>

<h3 id="streaming-decision">Streaming Decision</h3>

<p>Currently, all responses are sent as standard JSON. The framework supports streaming for:</p>

<ul>
  <li>Long-running tool executions</li>
  <li>Large resource reads</li>
  <li>Real-time notifications</li>
</ul>

<h3 id="request-logging">Request Logging</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Handling MCP request</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">method</span><span class="p">,</span>
    <span class="nx">id</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">),</span>
<span class="p">});</span>

<span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Request completed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">method</span><span class="p">,</span>
    <span class="na">duration</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">,</span>
    <span class="na">streaming</span><span class="p">:</span> <span class="nx">shouldStream</span> <span class="o">&amp;&amp;</span> <span class="nx">acceptsSSE</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<ol>
  <li><strong>Input Validation</strong>: All requests are validated for JSON-RPC format</li>
  <li><strong>Error Sanitization</strong>: Internal errors don’t expose stack traces</li>
  <li><strong>Session Isolation</strong>: Each client gets a unique session</li>
  <li><strong>Header Security</strong>: Proper CORS and security headers at Express level</li>
  <li><strong>Authentication</strong>: Handled by AIRS client (API key not exposed)</li>
</ol>

<h2 id="testing-strategies">Testing Strategies</h2>

<h3 id="unit-tests">Unit Tests</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">HttpServerTransport</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should route tools/list correctly</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpServerTransport</span><span class="p">({</span><span class="nx">server</span><span class="p">,</span> <span class="nx">logger</span><span class="p">});</span>
        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">transport</span><span class="p">.</span><span class="nx">routeRequest</span><span class="p">(</span><span class="dl">'</span><span class="s1">tools/list</span><span class="dl">'</span><span class="p">,</span> <span class="p">{});</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toHaveProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">tools</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should handle invalid methods</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpServerTransport</span><span class="p">({</span><span class="nx">server</span><span class="p">,</span> <span class="nx">logger</span><span class="p">});</span>
        <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span>
            <span class="nx">transport</span><span class="p">.</span><span class="nx">routeRequest</span><span class="p">(</span><span class="dl">'</span><span class="s1">invalid/method</span><span class="dl">'</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="dl">'</span><span class="s1">Method not found</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="integration-tests">Integration Tests</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Transport Integration</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should handle full request cycle</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-1</span><span class="dl">'</span>
            <span class="p">});</span>

        <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">jsonrpc</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-1</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues</h3>

<ol>
  <li><strong>SSE Connection Drops</strong>
    <ul>
      <li>Check proxy timeout settings</li>
      <li>Ensure <code class="language-plaintext highlighter-rouge">X-Accel-Buffering: no</code> header</li>
      <li>Implement heartbeat mechanism</li>
    </ul>
  </li>
  <li><strong>Session Not Found</strong>
    <ul>
      <li>Sessions are in-memory only</li>
      <li>Check <code class="language-plaintext highlighter-rouge">Mcp-Session-Id</code> header</li>
      <li>Verify session creation</li>
    </ul>
  </li>
  <li><strong>Method Routing Errors</strong>
    <ul>
      <li>Verify method name in switch statement</li>
      <li>Check handler registration</li>
      <li>Review error logs</li>
    </ul>
  </li>
</ol>

<h3 id="debug-mode">Debug Mode</h3>

<p>Enable detailed logging:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug npm start
</code></pre></div></div>

<h2 id="future-enhancements">Future Enhancements</h2>

<ol>
  <li><strong>Streaming Implementation</strong>
    <ul>
      <li>Add progress events for long operations</li>
      <li>Implement chunked responses</li>
      <li>Support cancellation</li>
    </ul>
  </li>
  <li><strong>Session Persistence</strong>
    <ul>
      <li>Redis-backed sessions</li>
      <li>Session expiration</li>
      <li>Multi-instance support</li>
    </ul>
  </li>
  <li><strong>Enhanced Security</strong>
    <ul>
      <li>Rate limiting per session</li>
      <li>Request size limits</li>
      <li>Method-specific timeouts</li>
    </ul>
  </li>
</ol>

<h2 id="related-documentation">Related Documentation</h2>

<ul>
  <li><a href="/developers/src/">Application Entry Point</a> - Express server setup</li>
  <li><a href="/developers/src/types/">Types Module</a> - Transport type definitions</li>
  <li><a href="/developers/src/tools/">Tools Module</a> - Tool handler implementation</li>
  <li><a href="/developers/src/resources/">Resources Module</a> - Resource handler implementation</li>
</ul>

      </article>
      
      <div class="content-footer">
        <div class="edit-page">
          <a href="https://github.com/cdot65/prisma-airs-mcp/edit/main/docs/_developers/src/transport.md">
            <i class="fas fa-edit"></i> Edit this page on GitHub
          </a>
        </div>
        
        
        <div class="pagination">
          
          
          <a href="/developers/src/types/" class="next">
            Types Module <i class="fas fa-arrow-right"></i>
          </a>
          
        </div>
        
      </div>
    </main>
    
    <aside class="toc">
      <h4>On this page</h4>
      <nav id="table-of-contents"></nav>
    </aside>
  </div>

  <!-- Syntax highlighting is handled by Jekyll Rouge -->
  <script src="/assets/js/main.js"></script>
</body>
</html>