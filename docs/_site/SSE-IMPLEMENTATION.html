<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SSE Implementation for Streamable HTTP Transport - Prisma AIRS MCP</title>
  <meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection">
  
  <!-- SEO -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="SSE Implementation for Streamable HTTP Transport" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection" />
<meta property="og:description" content="AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection" />
<link rel="canonical" href="https://cdot65.github.io/prisma-airs-mcp/SSE-IMPLEMENTATION.html" />
<meta property="og:url" content="https://cdot65.github.io/prisma-airs-mcp/SSE-IMPLEMENTATION.html" />
<meta property="og:site_name" content="Prisma AIRS MCP" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SSE Implementation for Streamable HTTP Transport" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"AI Runtime Security through Model Context Protocol - Secure your AI applications with enterprise-grade threat detection","headline":"SSE Implementation for Streamable HTTP Transport","url":"https://cdot65.github.io/prisma-airs-mcp/SSE-IMPLEMENTATION.html"}</script>
<!-- End Jekyll SEO tag -->

  
  <!-- CSS -->
  <link rel="stylesheet" href="/prisma-airs-mcp/assets/css/style.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/prisma-airs-mcp/assets/favicon.png">
</head>
<body>
  <h1 id="sse-implementation-for-streamable-http-transport">SSE Implementation for Streamable HTTP Transport</h1>

<p>This document describes the Server-Sent Events (SSE) implementation for the MCP serverâ€™s Streamable HTTP transport.</p>

<h2 id="overview">Overview</h2>

<p>The Streamable HTTP transport extends the standard HTTP transport by adding support for Server-Sent Events (SSE), enabling:</p>

<ul>
  <li>Server-to-client streaming of responses</li>
  <li>Long-running operation updates</li>
  <li>Real-time notifications</li>
  <li>Backwards compatibility with legacy SSE transport</li>
</ul>

<h2 id="architecture">Architecture</h2>

<h3 id="components">Components</h3>

<ol>
  <li><strong>SSETransport</strong> (<code class="language-plaintext highlighter-rouge">src/transport/sse.ts</code>)
    <ul>
      <li>Manages SSE connections and client state</li>
      <li>Handles message formatting and delivery</li>
      <li>Provides connection lifecycle management</li>
    </ul>
  </li>
  <li><strong>HttpServerTransport</strong> (<code class="language-plaintext highlighter-rouge">src/transport/http.ts</code>)
    <ul>
      <li>Extended to support both standard JSON and SSE responses</li>
      <li>Session management for stateful connections</li>
      <li>Automatic detection of SSE-capable clients</li>
    </ul>
  </li>
</ol>

<h2 id="protocol-support">Protocol Support</h2>

<h3 id="client-to-server-post-">Client-to-Server (POST /)</h3>

<p>Clients send standard JSON-RPC 2.0 requests with optional SSE support:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/event-stream</span>
<span class="na">Mcp-Session-Id</span><span class="p">:</span> <span class="s">&lt;optional-session-id&gt;</span>

<span class="p">{</span><span class="w">
  </span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tools/call"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="server-to-client-responses">Server-to-Client Responses</h3>

<p>The server can respond in two ways:</p>

<ol>
  <li><strong>Standard JSON Response</strong> (default)</li>
</ol>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
  </span><span class="nl">"jsonrpc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ol>
  <li><strong>SSE Stream</strong> (when client accepts and method supports streaming)</li>
</ol>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/event-stream</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>
<span class="na">Mcp-Session-Id</span><span class="p">:</span> <span class="s">&lt;session-id&gt;</span>

event: connect
data: {"connected": true}

id: 1
event: message
data: {"jsonrpc":"2.0","result":{...},"id":1}
</code></pre></div></div>

<h3 id="server-initiated-streams-get-">Server-Initiated Streams (GET /)</h3>

<p>Clients can establish persistent SSE connections:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/event-stream</span>
<span class="na">Last-Event-ID</span><span class="p">:</span> <span class="s">&lt;optional-last-event-id&gt;</span>
<span class="na">Mcp-Session-Id</span><span class="p">:</span> <span class="s">&lt;optional-session-id&gt;</span>
</code></pre></div></div>

<h2 id="features">Features</h2>

<h3 id="session-management">Session Management</h3>

<ul>
  <li>Automatic session creation with UUID v4</li>
  <li>Session persistence across requests</li>
  <li>Session ID returned in <code class="language-plaintext highlighter-rouge">Mcp-Session-Id</code> header</li>
</ul>

<h3 id="event-types">Event Types</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">connect</code> - Initial connection confirmation</li>
  <li><code class="language-plaintext highlighter-rouge">endpoint</code> - Legacy compatibility event</li>
  <li><code class="language-plaintext highlighter-rouge">message</code> - JSON-RPC responses</li>
  <li><code class="language-plaintext highlighter-rouge">notification</code> - Server-initiated notifications</li>
</ul>

<h3 id="streaming-decision-logic">Streaming Decision Logic</h3>

<p>The server determines whether to stream based on:</p>

<ol>
  <li>Client accepts <code class="language-plaintext highlighter-rouge">text/event-stream</code></li>
  <li>Method is configured as streamable</li>
  <li>Response characteristics (size, duration, etc.)</li>
</ol>

<p>Currently configured streamable methods:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tools/call</code> - Long-running tool executions</li>
  <li><code class="language-plaintext highlighter-rouge">resources/read</code> - Large resource transfers</li>
</ul>

<h3 id="connection-management">Connection Management</h3>

<ul>
  <li>Automatic cleanup on client disconnect</li>
  <li>Configurable timeouts</li>
  <li>Graceful shutdown handling</li>
  <li>Multiple concurrent connections support</li>
</ul>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="javascriptnodejs-client">JavaScript/Node.js Client</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">EventSource</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">eventsource</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Establish SSE connection</span>
<span class="kd">const</span> <span class="nx">es</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSource</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">Accept</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">Mcp-Session-Id</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-session-123</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="nx">es</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Received:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Send request expecting SSE response</span>
<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">Accept</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json, text/event-stream</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="na">jsonrpc</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2.0</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">tool</span><span class="p">:</span> <span class="dl">'</span><span class="s1">long-running-tool</span><span class="dl">'</span> <span class="p">},</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">)?.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// Handle SSE stream</span>
  <span class="kd">const</span> <span class="nx">reader</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getReader</span><span class="p">();</span>
  <span class="c1">// Process stream...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="testing">Testing</h3>

<p>Use the provided example client:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install dependencies</span>
npm <span class="nb">install </span>eventsource

<span class="c"># Run the example</span>
node examples/sse-client.js
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<ol>
  <li><strong>Origin Validation</strong>: Implement CORS and validate Origin headers</li>
  <li><strong>Session Security</strong>: Use cryptographically secure session IDs</li>
  <li><strong>Rate Limiting</strong>: Apply per-session rate limits</li>
  <li><strong>Connection Limits</strong>: Limit concurrent SSE connections per client</li>
  <li><strong>Timeouts</strong>: Implement appropriate connection timeouts</li>
</ol>

<h2 id="future-enhancements">Future Enhancements</h2>

<ol>
  <li><strong>Streaming Tool Results</strong>: Stream partial results for long-running tools</li>
  <li><strong>Progress Updates</strong>: Send progress notifications during processing</li>
  <li><strong>Chunked Resources</strong>: Stream large resources in chunks</li>
  <li><strong>Bidirectional Streaming</strong>: Full duplex communication via WebSockets</li>
  <li><strong>Compression</strong>: Support for SSE data compression</li>
</ol>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>The implementation supports legacy SSE clients by:</p>

<ol>
  <li>Sending <code class="language-plaintext highlighter-rouge">endpoint</code> events on connection</li>
  <li>Supporting the <code class="language-plaintext highlighter-rouge">/messages</code> endpoint reference</li>
  <li>Accepting connections without session IDs</li>
  <li>Graceful fallback to standard JSON responses</li>
</ol>

<h2 id="configuration">Configuration</h2>

<p>Future configuration options may include:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">sse</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">maxConnections</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="na">connectionTimeout</span><span class="p">:</span> <span class="mi">300000</span><span class="p">,</span> <span class="c1">// 5 minutes</span>
    <span class="na">heartbeatInterval</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>  <span class="c1">// 30 seconds</span>
    <span class="na">streamableMethod</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">resources/read</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">compressionThreshold</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span> <span class="c1">// 10KB</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

</body>
</html>